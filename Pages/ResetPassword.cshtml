@page
@model WebApplication1.Pages.ResetPasswordModel
@{
    ViewData["Title"] = "Reset Password";
}

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <div class="auth-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                </svg>
            </div>
            <h1>Reset Password</h1>
            <p class="auth-subtitle">Enter your new password below</p>
        </div>

        @if (Model.ResetSucceeded)
        {
            <div class="alert alert-success" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </svg>
                Your password has been reset successfully.
            </div>
            <div class="auth-footer">
                <p><a asp-page="/Login" class="btn btn-primary w-100">Sign In</a></p>
            </div>
        }
        else
        {
            <form method="post">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                <input type="hidden" asp-for="Token" />
                <input type="hidden" asp-for="Email" />

                <div class="form-floating mb-3">
                    <input type="password" asp-for="Password" class="form-control" id="password" 
                           placeholder="New Password" oninput="checkPasswordStrength(this.value)" />
                    <label asp-for="Password">New Password</label>
                    <span asp-validation-for="Password" class="text-danger small"></span>
                </div>

                <div class="password-strength-container mb-3">
                    <div class="password-strength-bar">
                        <div id="strengthBar" class="password-strength-fill"></div>
                    </div>
                    <small id="strengthText" class="password-strength-text">Enter a password</small>
                    <div class="password-checklist mt-2">
                        <div id="chkLength" class="checklist-item"><span class="check-icon">&#10007;</span> At least 12 characters</div>
                        <div id="chkUpper" class="checklist-item"><span class="check-icon">&#10007;</span> Uppercase letter</div>
                        <div id="chkLower" class="checklist-item"><span class="check-icon">&#10007;</span> Lowercase letter</div>
                        <div id="chkDigit" class="checklist-item"><span class="check-icon">&#10007;</span> Number</div>
                        <div id="chkSpecial" class="checklist-item"><span class="check-icon">&#10007;</span> Special character</div>
                    </div>
                </div>

                <div class="form-floating mb-4">
                    <input type="password" asp-for="ConfirmPassword" class="form-control" id="confirmPassword" placeholder="Confirm Password" />
                    <label asp-for="ConfirmPassword">Confirm New Password</label>
                    <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                </div>

                <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                    Reset Password
                </button>
            </form>

            <div class="auth-footer">
                <p><a asp-page="/Login" class="link-primary">Back to Sign In</a></p>
            </div>
        }
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function checkPasswordStrength(password) {
            var hasLength = password.length >= 12;
            var hasUpper = /[A-Z]/.test(password);
            var hasLower = /[a-z]/.test(password);
            var hasDigit = /[0-9]/.test(password);
            var hasSpecial = /[^A-Za-z0-9]/.test(password);

            updateChecklist('chkLength', hasLength);
            updateChecklist('chkUpper', hasUpper);
            updateChecklist('chkLower', hasLower);
            updateChecklist('chkDigit', hasDigit);
            updateChecklist('chkSpecial', hasSpecial);

            var score = [hasLength, hasUpper, hasLower, hasDigit, hasSpecial].filter(Boolean).length;
            var bar = document.getElementById('strengthBar');
            var text = document.getElementById('strengthText');

            if (password.length === 0) {
                bar.style.width = '0%';
                bar.className = 'password-strength-fill';
                text.textContent = 'Enter a password';
                text.className = 'password-strength-text';
                return;
            }

            if (score <= 2) {
                bar.style.width = '33%';
                bar.className = 'password-strength-fill strength-weak';
                text.textContent = 'Weak';
                text.className = 'password-strength-text text-danger';
            } else if (score <= 4) {
                bar.style.width = '66%';
                bar.className = 'password-strength-fill strength-medium';
                text.textContent = 'Medium';
                text.className = 'password-strength-text text-warning';
            } else {
                bar.style.width = '100%';
                bar.className = 'password-strength-fill strength-strong';
                text.textContent = 'Strong';
                text.className = 'password-strength-text text-success';
            }
        }

        function updateChecklist(id, passed) {
            var el = document.getElementById(id);
            var icon = el.querySelector('.check-icon');
            if (passed) {
                el.classList.add('passed');
                el.classList.remove('failed');
                icon.innerHTML = '&#10003;';
            } else {
                el.classList.remove('passed');
                el.classList.add('failed');
                icon.innerHTML = '&#10007;';
            }
        }
    </script>
}
