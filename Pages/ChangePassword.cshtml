@page
@model WebApplication1.Pages.ChangePasswordModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <div class="auth-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                </svg>
            </div>
            <h1>Change Password</h1>
            <p class="auth-subtitle">Update your password to keep your account secure</p>
        </div>

        <form method="post">
            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

            <div class="form-floating mb-3">
                <input type="password" asp-for="CPModel.CurrentPassword" class="form-control" id="currentPassword" placeholder="Current Password" />
                <label asp-for="CPModel.CurrentPassword">Current Password</label>
                <span asp-validation-for="CPModel.CurrentPassword" class="text-danger small"></span>
            </div>

            <div class="form-floating mb-3">
                <input type="password" asp-for="CPModel.NewPassword" class="form-control" id="newPassword" placeholder="New Password" oninput="checkPasswordStrength(this.value)" />
                <label asp-for="CPModel.NewPassword">New Password</label>
                <span asp-validation-for="CPModel.NewPassword" class="text-danger small"></span>
            </div>

            <div class="password-strength-container mb-3">
                <div class="password-strength-bar">
                    <div id="strengthBar" class="password-strength-fill"></div>
                </div>
                <small id="strengthText" class="password-strength-text">Enter a password</small>
                <div class="password-checklist mt-2">
                    <div id="chkLength" class="checklist-item"><span class="check-icon">&#10007;</span> At least 12 characters</div>
                    <div id="chkUpper" class="checklist-item"><span class="check-icon">&#10007;</span> Uppercase letter</div>
                    <div id="chkLower" class="checklist-item"><span class="check-icon">&#10007;</span> Lowercase letter</div>
                    <div id="chkDigit" class="checklist-item"><span class="check-icon">&#10007;</span> Number</div>
                    <div id="chkSpecial" class="checklist-item"><span class="check-icon">&#10007;</span> Special character</div>
                </div>
            </div>

            <div class="form-floating mb-4">
                <input type="password" asp-for="CPModel.ConfirmPassword" class="form-control" id="confirmPassword" placeholder="Confirm New Password" />
                <label asp-for="CPModel.ConfirmPassword">Confirm New Password</label>
                <span asp-validation-for="CPModel.ConfirmPassword" class="text-danger small"></span>
            </div>

            <div class="password-requirements mb-4">
                <small class="text-muted">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                    Password must be at least 12 characters with uppercase, lowercase, digit, and special character.
                </small>
            </div>

            <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9A1.5 1.5 0 0 1 1.5 3H2V1.78a1.5 1.5 0 0 1 1.864-1.456l8.272 2.002zM1.5 4a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-13z"/>
                </svg>
                Update Password
            </button>
        </form>

        <div class="auth-footer">
            <p><a asp-page="/Dashboard" class="link-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
                Back to Dashboard
            </a></p>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function checkPasswordStrength(password) {
            var hasLength = password.length >= 12;
            var hasUpper = /[A-Z]/.test(password);
            var hasLower = /[a-z]/.test(password);
            var hasDigit = /[0-9]/.test(password);
            var hasSpecial = /[^A-Za-z0-9]/.test(password);

            updateChecklist('chkLength', hasLength);
            updateChecklist('chkUpper', hasUpper);
            updateChecklist('chkLower', hasLower);
            updateChecklist('chkDigit', hasDigit);
            updateChecklist('chkSpecial', hasSpecial);

            var score = [hasLength, hasUpper, hasLower, hasDigit, hasSpecial].filter(Boolean).length;
            var bar = document.getElementById('strengthBar');
            var text = document.getElementById('strengthText');

            if (password.length === 0) {
                bar.style.width = '0%';
                bar.className = 'password-strength-fill';
                text.textContent = 'Enter a password';
                text.className = 'password-strength-text';
                return;
            }

            if (score <= 2) {
                bar.style.width = '33%';
                bar.className = 'password-strength-fill strength-weak';
                text.textContent = 'Weak';
                text.className = 'password-strength-text text-danger';
            } else if (score <= 4) {
                bar.style.width = '66%';
                bar.className = 'password-strength-fill strength-medium';
                text.textContent = 'Medium';
                text.className = 'password-strength-text text-warning';
            } else {
                bar.style.width = '100%';
                bar.className = 'password-strength-fill strength-strong';
                text.textContent = 'Strong';
                text.className = 'password-strength-text text-success';
            }
        }

        function updateChecklist(id, passed) {
            var el = document.getElementById(id);
            var icon = el.querySelector('.check-icon');
            if (passed) {
                el.classList.add('passed');
                el.classList.remove('failed');
                icon.innerHTML = '&#10003;';
            } else {
                el.classList.remove('passed');
                el.classList.add('failed');
                icon.innerHTML = '&#10007;';
            }
        }
    </script>
}
